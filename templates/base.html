<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}{% endblock %}</title>
    <meta http-equiv="Cache-Control" content="no-store" />

    <!-- ðŸ”¥ CSS barra allerta -->
    <style>
    .barra-allerta {
        width: 100%;
        background-color: #cc0000;
        color: white;
        padding: 8px 0;
        font-weight: bold;
        font-size: 18px;
        overflow: hidden;
        white-space: nowrap;
        position: fixed;
        top: 60px;
        left: 0;
        z-index: 9999;
    }

    .barra-allerta span {
        display: inline-block;
        padding-left: 100%;
        animation: scorrimento 12s linear infinite;
    }

    @keyframes scorrimento {
        0%   { transform: translateX(0%); }
        100% { transform: translateX(-100%); }
    }
    </style>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <!-- Manifest PWA -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='img/logo.ico') }}">

    <!-- iOS Splash Screen -->
    <link rel="apple-touch-startup-image" href="{{ url_for('static', filename='img/splash.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/logo.png') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="white">

    <style>
        body {
            background: linear-gradient(135deg, #e8f0ff, #ffffff);
            margin: 0;
            padding: 0;
            padding-top: 100px; /* spazio per header fisso */
        }

        /* HEADER FISSO */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: #ffffffcc;
            backdrop-filter: blur(6px);
            z-index: 1000;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .header-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: #002b5c;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* FOOTER */
        .footer {
            background: #f5f5f5;
            padding: 15px;
            text-align: center;
            color: #666;
            margin-top: 40px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>

    <!-- HEADER -->
    <header class="header">
        <div class="container d-flex align-items-center py-2">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" height="60" class="me-3">
            <div class="header-title">Protezione Civile VAS</div>
        </div>

    </header>
    <!-- ðŸ”¥ BARRA ALLERTA ROSSA -->
    <div id="barra-allerta" class="barra-allerta" style="display:none;">
        <span id="testo-allerta"></span>
    </div>


    <!-- CONTENUTO PAGINA -->
    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        Â© Protezione Civile VAS â€“ Tutti i diritti riservati
    </footer>

    <!-- SERVICE WORKER -->
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/static/sw.js");
        }
    </script>

    <!-- ðŸ”¥ SCRIPT aggiornamento barra allerta -->
    <script>
    function aggiornaAllerta() {
        fetch("/api/allerta")
            .then(r => r.json())
            .then(data => {

                const barra = document.getElementById("barra-allerta");
                const testo = document.getElementById("testo-allerta");

                if (data.colore === "rosso") {
                    testo.innerText = "ðŸš¨ " + (data.messaggio || "ALLERTA ROSSA IN CORSO") + " ðŸš¨";
                    barra.style.display = "block";
                } else {
                    barra.style.display = "none";
                }
            });
    }

    aggiornaAllerta();
    setInterval(aggiornaAllerta, 10000);
    </script>

</body>
</html>