{% extends "base.html" %}
{% block title %}Invia Allerta{% endblock %}

{% block content %}

<style>
    .allerta-wrapper {
        max-width: 800px;
        margin: 0 auto;
        margin-top: 60px;
        animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .allerta-card {
        background: white;
        padding: 50px;
        border-radius: 25px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.18);
        margin-bottom: 40px;
        border: 8px solid #ccc; /* verrÃ  cambiato via JS */
        transition: border-color 0.3s ease;
    }

    .allerta-icon {
        font-size: 5rem;
        text-align: center;
        margin-bottom: 20px;
        color: #b30000;
    }

    .allerta-title {
        font-size: 2.6rem;
        font-weight: 900;
        color: #b30000;
        margin-bottom: 35px;
        text-align: center;
    }

    .form-label {
        font-weight: 800;
        margin-top: 25px;
        font-size: 1.4rem;
    }

    select.form-select,
    input.form-control,
    textarea.form-control {
        font-size: 1.4rem;
        padding: 18px;
        border-radius: 14px;
        margin-top: 8px;
    }

    textarea.form-control {
        height: 200px;
    }

    .btn-invia {
        width: 100%;
        padding: 28px;
        font-size: 1.8rem;
        font-weight: 800;
        border-radius: 20px;
        background: #d40000;
        color: white;
        border: none;
        box-shadow: 0 6px 16px rgba(212,0,0,0.45);
        transition: transform 0.15s ease;
        margin-top: 35px;
    }

    .btn-invia:hover {
        transform: scale(1.04);
    }

    .status-box {
        margin-top: 30px;
        font-size: 1.3rem;
        color: #444;
        text-align: center;
    }
</style>

<div class="allerta-wrapper">
    <div id="allertaCard" class="allerta-card">

        <!-- ðŸ”¥ ICONA GRANDE -->
        <div class="allerta-icon">ðŸš¨</div>

        <div class="allerta-title">Invia Allerta</div>

        <!-- Selezione gruppo -->
        <label class="form-label">Gruppo destinatario</label>
        <select id="gruppo" class="form-select">
            {% for g in gruppi %}
                <option value="{{ g[0] }}">{{ g[1] }}</option>
            {% endfor %}
        </select>

        <!-- Selezione livello -->
        <label class="form-label">Livello di allerta</label>
        <select id="livello" class="form-select">
            <option value="verde">ðŸŸ¢ Verde â€“ Nessun rischio</option>
            <option value="gialla">ðŸŸ¡ Gialla â€“ Attenzione</option>
            <option value="arancione">ðŸŸ  Arancione â€“ Preallarme</option>
            <option value="rossa">ðŸ”´ Rossa â€“ Emergenza</option>
        </select>

        <!-- Titolo -->
        <label class="form-label">Titolo</label>
        <input id="titolo" class="form-control" placeholder="Es: ALLERTA ROSSA â€“ Incendio boschivo">

        <!-- Messaggio -->
        <label class="form-label">Messaggio</label>
        <textarea id="messaggio" class="form-control" placeholder="Descrivi l'emergenza..."></textarea>

        <!-- Pulsante invio -->
        <button id="btnInvia" class="btn-invia">ðŸš¨ Invia Allerta</button>

        <div id="statusBox" class="status-box">Stato: in attesa.</div>
    </div>
</div>

<script>
/* ðŸ”¥ CAMBIO COLORE BORDO IN BASE AL LIVELLO */
const livelloSelect = document.getElementById("livello");
const card = document.getElementById("allertaCard");

function aggiornaBordo() {
    const livello = livelloSelect.value;

    const colori = {
        verde: "#2ecc71",
        gialla: "#f1c40f",
        arancione: "#e67e22",
        rossa: "#c0392b"
    };

    card.style.borderColor = colori[livello];
}

livelloSelect.addEventListener("change", aggiornaBordo);
aggiornaBordo(); // iniziale

/* ðŸ”¥ INVIO ALLERTA */
document.getElementById("btnInvia").onclick = async () => {
    const gruppo_id = document.getElementById("gruppo").value;
    const livello = document.getElementById("livello").value;
    const titolo = document.getElementById("titolo").value;
    const messaggio = document.getElementById("messaggio").value;

    const statusBox = document.getElementById("statusBox");

    if (!titolo || !messaggio) {
        alert("Compila titolo e messaggio.");
        return;
    }

    const res = await fetch("/api/send_alert_group", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            gruppo_id,
            livello,
            titolo,
            messaggio
        })
    });

    statusBox.textContent = "Allerta inviata correttamente.";
    alert("Allerta inviata!");
};
</script>

{% endblock %}