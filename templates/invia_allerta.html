{% extends "base.html" %}
{% block title %}Invia Allerta{% endblock %}

{% block content %}

<style>
    .allerta-wrapper {
        max-width: 700px;
        margin: 0 auto;
        margin-top: 40px;
        animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .allerta-card {
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        margin-bottom: 30px;
    }

    .allerta-title {
        font-size: 2rem;
        font-weight: 800;
        color: #b30000;
        margin-bottom: 20px;
        text-align: center;
    }

    .form-label {
        font-weight: 700;
        margin-top: 15px;
    }

    .btn-invia {
        width: 100%;
        padding: 18px;
        font-size: 1.4rem;
        font-weight: 700;
        border-radius: 16px;
        background: #d40000;
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(212,0,0,0.4);
        transition: transform 0.15s ease;
        margin-top: 20px;
    }

    .btn-invia:hover {
        transform: scale(1.03);
    }

    .status-box {
        margin-top: 20px;
        font-size: 1rem;
        color: #444;
        text-align: center;
    }
</style>

<div class="allerta-wrapper">
    <div class="allerta-card">
        <div class="allerta-title">Invia Allerta</div>

        <!-- Selezione gruppo -->
        <label class="form-label">Gruppo destinatario</label>
        <select id="gruppo" class="form-select">
            {% for g in gruppi %}
                <option value="{{ g[0] }}">{{ g[1] }}</option>
            {% endfor %}
        </select>

        <!-- Selezione livello -->
        <label class="form-label">Livello di allerta</label>
        <select id="livello" class="form-select">
            <option value="verde">ðŸŸ¢ Verde â€“ Nessun rischio</option>
            <option value="gialla">ðŸŸ¡ Gialla â€“ Attenzione</option>
            <option value="arancione">ðŸŸ  Arancione â€“ Preallarme</option>
            <option value="rossa">ðŸ”´ Rossa â€“ Emergenza</option>
        </select>

        <!-- Titolo -->
        <label class="form-label">Titolo</label>
        <input id="titolo" class="form-control" placeholder="Es: ALLERTA ROSSA â€“ Incendio boschivo">

        <!-- Messaggio -->
        <label class="form-label">Messaggio</label>
        <textarea id="messaggio" class="form-control" rows="4" placeholder="Descrivi l'emergenza..."></textarea>

        <!-- Pulsante invio -->
        <button id="btnInvia" class="btn-invia">ðŸš¨ Invia Allerta</button>

        <div id="statusBox" class="status-box">Stato: in attesa.</div>
    </div>
</div>

<script>
document.getElementById("btnInvia").onclick = async () => {
    const gruppo_id = document.getElementById("gruppo").value;
    const livello = document.getElementById("livello").value;
    const titolo = document.getElementById("titolo").value;
    const messaggio = document.getElementById("messaggio").value;

    const statusBox = document.getElementById("statusBox");

    if (!titolo || !messaggio) {
        alert("Compila titolo e messaggio.");
        return;
    }

    const res = await fetch("/api/send_alert_group", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            gruppo_id,
            livello,
            titolo,
            messaggio
        })
    });

    statusBox.textContent = "Allerta inviata correttamente.";
    alert("Allerta inviata!");
};
</script>

{% endblock %}
